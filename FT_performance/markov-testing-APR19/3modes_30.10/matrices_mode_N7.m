%% n = 7

%% transition matrix n=7 -> 20 states

% initialization
states = 20;

m = zeros(states,states);
t = zeros(states,states);


% probabilities
m(1,2) = Pfm(1);
m(1,8) = 1-Pfm(1);

m(2,3) = Pfm(2);
m(2,9) = 1-Pfm(2);

m(3,4) = Pfm(3);
m(3,10) = 1-Pfm(3);

m(4,5) = Pfm(4);
m(4,11) = 1-Pfm(4);

m(5,6) = Pfm(5);
m(5,12) = 1-Pfm(5);

m(6,7) = Pfm(6);
m(6,13) = 1-Pfm(6);

m(7,14) = Pfm(7);
m(7,20) = 1-Pfm(7);


m(8,8) = 1-(x(1)+y(1));
if f(1)-1 == 0
  m(8,9) = 1-Pfm(1);
  m(8,20) = Pfm(1);
else
  m(8,9) = x(1);
  m(8,20) = y(1);
end

m(9,9) = 1-(x(2)+y(2));
if f(2)-1 == 0
    m(9,15) = 1-Pfm(2);
    m(9,20) = Pfm(2);
else
    m(9,15) = x(2);
    m(9,20) = y(2);
end


m(10,10) = 1-(x(3)+y(3));
if f(3)-1 == 0
    m(10,16) = 1-Pfm(3);
    m(10,20) = Pfm(3);
else
    m(10,16) = x(3);
    m(10,20) = y(3);    
end


m(11,11) = 1-(x(4)+y(4));
if f(4)-1 == 0
    m(11,17) = 1-Pfm(4);
    m(11,20) = Pfm(4);
else
    m(11,17) = x(4);
    m(11,20) = y(4);    
end

m(12,12) = 1-(x(5)+y(5));
if f(5)-1 == 0
    m(12,18)  = 1-Pfm(5);
    m(12,20) = Pfm(5);
else
    m(12,18)  = x(5);
    m(12,20) = y(5);    
end

m(13,13) = 1-(x(6)+y(6));
if f(6)-1 == 0
    m(13,19)  = 1-Pfm(6);
    m(13,20) = Pfm(6);
else
    m(13,19)  = x(6);
    m(13,20) = y(6);    
end

m(14,14) = 1-(x(7)+y(7));
if f(7)-1 == 0
    m(14,13)  = 1-Pfm(7);
    m(14,20) = Pfm(7);
else
    m(14,13)  = x(7);
    m(14,20) = y(7);    
end


m(15,8) = 1-Pfm(2);
m(15,10) = Pfm(2);

m(16,9) = 1-Pfm(3);
m(16,11) = Pfm(3);

m(17,10) = 1-Pfm(4);
m(17,12) = Pfm(4);

m(18,11) = 1-Pfm(5);
m(18,13) = Pfm(5);

m(19,12) = 1-Pfm(6);
m(19,14) = Pfm(6);

m(20,20) = 1;

M_N7 = m;


    
% time    
t(1,2) = tm(1);
t(1,8) = tm(1);

t(2,3) = tm(2);
t(2,9) = tm(2);

t(3,4) = tm(3);
t(3,10) = tm(3);

t(4,5) = tm(4);
t(4,11) = tm(4);

t(5,6) = tm(5);
t(5,12) = tm(5);

t(6,7) = tm(6);
t(6,13) = tm(6);

t(7,14) = tm(7);
t(7,20) = tm(7);

if f(1)-1 == 0
  t(8,8) = tm(1);
  t(8,9) = tm(1);
  t(8,20) = tm(1);
else
  t(8,8) = tm(1) * (f(1)-1);
  t(8,9) = tm(1) * (f(1)-1);
  t(8,20) = tm(1) * (f(1)-1);
end


if f(2)-1 == 0
    t(9,9) = tm(2);
    t(9,15) = tm(2);
    t(9,20) = tm(2);
else
    t(9,9) = tm(2) * (f(2)-1);
    t(9,15) = tm(2) * (f(2)-1);
    t(9,20) = tm(2) * (f(2)-1);
end


if f(3)-1 == 0
    t(10,10) = tm(3);
    t(10,16) = tm(3);
    t(10,20) = tm(3);
else
    t(10,10) = tm(3) * (f(3)-1);
    t(10,16) = tm(3) * (f(3)-1);
    t(10,20) = tm(3) * (f(3)-1);
end


if f(4)-1 == 0
    t(11,11) = tm(4);
    t(11,17) = tm(4);
    t(11,20) = tm(4);
else
    t(11,11) = tm(4) * (f(4)-1);
    t(11,17) = tm(4) * (f(4)-1);
    t(11,20) = tm(4) * (f(4)-1);
end


if f(5)-1 == 0
    t(12,11) = tm(5);
    t(12,18)  = tm(5);
    t(12,20) = tm(5);
else
    t(12,11) = tm(5) * (f(5)-1);
    t(12,18)  = tm(5) * (f(5)-1);
    t(12,20) = tm(5) * (f(5)-1);
end


if f(6)-1 == 0
    t(13,13) = tm(6);
    t(13,19)  = tm(6);
    t(13,20) = tm(6);
else
    t(13,13) = tm(6) * (f(6)-1);
    t(13,19)  = tm(6) * (f(6)-1);
    t(13,20) = tm(6) * (f(6)-1);
end


if f(7)-1 == 0
    t(14,14) = tm(7);
    t(14,13)  = tm(7);
    t(14,20) = tm(7);
else
    t(14,14) = tm(7) * (f(7)-1);
    t(14,13)  = tm(7) * (f(7)-1);
    t(14,20) = tm(7) * (f(7)-1);
end


t(15,8) = tm(2);
t(15,10) = tm(2);

t(16,9) = tm(3);
t(16,11) = tm(3);

t(17,10) = tm(4);
t(17,12) = tm(4);

t(18,11) = tm(5);
t(18,13) = tm(5);

t(19,12) = tm(6);
t(19,14) = tm(6);

T_N7 = t;

