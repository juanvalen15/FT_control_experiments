%% n = 3

%% transition matrix n=3 -> 8 states
m_01_01 = 0;
m_01_02 = Pfm(1);
m_01_03 = 0;
m_01_04 = 1-Pfm(1);
m_01_05 = 0;
m_01_06 = 0;
m_01_07 = 0;
m_01_08 = 0;

m_02_01 = 0;
m_02_02 = 0;
m_02_03 = Pfm(2);
m_02_04 = 0;
m_02_05 = 1-Pfm(2);
m_02_06 = 0;
m_02_07 = 0;
m_02_08 = 0;

m_03_01 = 0;
m_03_02 = 0;
m_03_03 = 0;
m_03_04 = 0;
m_03_05 = 0;
m_03_06 = 1-Pfm(3);
m_03_07 = 0;
m_03_08 = Pfm(3);

m_04_01 = 0;
m_04_02 = 0;
m_04_03 = 0;
m_04_04 = 1-(x1+y1);
m_04_06 = 0;
m_04_07 = 0;
if f(1)-1 == 0
  m_04_05 = 1-Pfm(1);
  m_04_08 = Pfm(1);
else
  m_04_05 = x1;
  m_04_08 = y1;
end

m_05_01 = 0;
m_05_02 = 0;
m_05_03 = 0;
m_05_04 = 0;
m_05_05 = 1-(x2+y2);
m_05_06 = 0;
if f(2)-1 == 0
  m_05_07 = 1-Pfm(2);
  m_05_08 = Pfm(2);
else
  m_05_07 = x2;
  m_05_08 = y2;
end

m_06_01 = 0;
m_06_02 = 0;
m_06_03 = 0;
m_06_04 = 0;
m_06_06 = 1-(x3+y3);
m_06_07 = 0;
if f(3)-1 == 0
  m_06_05 = 1-Pfm(3);
  m_06_08 = Pfm(3);
else
  m_06_05 = x3;
  m_06_08 = y3;
end

m_07_01 = 0;
m_07_02 = 0;
m_07_03 = 0;
m_07_04 = 1-Pfm(2);
m_07_05 = 0;
m_07_06 = Pfm(2);
m_07_07 = 0;
m_07_08 = 0;

m_08_01 = 0;
m_08_02 = 0;
m_08_03 = 0;
m_08_04 = 0;
m_08_05 = 0;
m_08_06 = 0;
m_08_07 = 0;
m_08_08 = 1;


M_N3 = [
    m_01_01 m_01_02 m_01_03 m_01_04 m_01_05 m_01_06 m_01_07 m_01_08; ...
    m_02_01 m_02_02 m_02_03 m_02_04 m_02_05 m_02_06 m_02_07 m_02_08; ...
    m_03_01 m_03_02 m_03_03 m_03_04 m_03_05 m_03_06 m_03_07 m_03_08; ...
    m_04_01 m_04_02 m_04_03 m_04_04 m_04_05 m_04_06 m_04_07 m_04_08; ...
    m_05_01 m_05_02 m_05_03 m_05_04 m_05_05 m_05_06 m_05_07 m_05_08; ...
    m_06_01 m_06_02 m_06_03 m_06_04 m_06_05 m_06_06 m_06_07 m_06_08; ...
    m_07_01 m_07_02 m_07_03 m_07_04 m_07_05 m_07_06 m_07_07 m_07_08; ...
    m_08_01 m_08_02 m_08_03 m_08_04 m_08_05 m_08_06 m_08_07 m_08_08;
    ];


% time
t_01_01 = 0;
t_01_02 = tm(1);
t_01_03 = 0;
t_01_04 = tm(1);
t_01_05 = 0;
t_01_06 = 0;
t_01_07 = 0;
t_01_08 = 0;

t_02_01 = 0;
t_02_02 = 0;
t_02_03 = tm(2);
t_02_04 = 0;
t_02_05 = tm(2);
t_02_06 = 0;
t_02_07 = 0;
t_02_08 = 0;

t_03_01 = 0;
t_03_02 = 0;
t_03_03 = 0;
t_03_04 = 0;
t_03_05 = 0;
t_03_06 = tm(3);
t_03_07 = 0;
t_03_08 = tm(3);

t_04_01 = 0;
t_04_02 = 0;
t_04_03 = 0;
t_04_06 = 0;
t_04_07 = 0;
if f(1)-1 == 0
  t_04_04 = tm(1);
  t_04_05 = tm(1);
  t_04_08 = tm(1);
else
  t_04_04 = tm(1) * (f(1)-1);
  t_04_05 = tm(1) * (f(1)-1);
  t_04_08 = tm(1) * (f(1)-1);
end

t_05_01 = 0;
t_05_02 = 0;
t_05_03 = 0;
t_05_04 = 0;
t_05_06 = 0;
if f(2)-1 == 0
  t_05_05 = tm(2);
  t_05_07 = tm(2);
  t_05_08 = tm(2);
else
  t_05_05 = tm(2) * (f(2)-1);
  t_05_07 = tm(2) * (f(2)-1);
  t_05_08 = tm(2) * (f(2)-1);
end

t_06_01 = 0;
t_06_02 = 0;
t_06_03 = 0;
t_06_04 = 0;
t_06_07 = 0;
if f(3)-1 == 0
  t_06_05 = tm(3);
  t_06_06 = tm(3);
  t_06_08 = tm(3);
else
  t_06_05 = tm(3) * (f(3)-1);
  t_06_06 = tm(3) * (f(3)-1);
  t_06_08 = tm(3) * (f(3)-1);
end

t_07_01 = 0;
t_07_02 = 0;
t_07_03 = 0;
t_07_04 = tm(2);
t_07_05 = 0;
t_07_06 = tm(2);
t_07_07 = 0;
t_07_08 = 0;

t_08_01 = 0;
t_08_02 = 0;
t_08_03 = 0;
t_08_04 = 0;
t_08_05 = 0;
t_08_06 = 0;
t_08_07 = 0;
t_08_08 = 0;


T_N3 = [
    t_01_01 t_01_02 t_01_03 t_01_04 t_01_05 t_01_06 t_01_07 t_01_08; ...
    t_02_01 t_02_02 t_02_03 t_02_04 t_02_05 t_02_06 t_02_07 t_02_08; ...
    t_03_01 t_03_02 t_03_03 t_03_04 t_03_05 t_03_06 t_03_07 t_03_08; ...
    t_04_01 t_04_02 t_04_03 t_04_04 t_04_05 t_04_06 t_04_07 t_04_08; ...
    t_05_01 t_05_02 t_05_03 t_05_04 t_05_05 t_05_06 t_05_07 t_05_08; ...
    t_06_01 t_06_02 t_06_03 t_06_04 t_06_05 t_06_06 t_06_07 t_06_08; ...
    t_07_01 t_07_02 t_07_03 t_07_04 t_07_05 t_07_06 t_07_07 t_07_08; ...
    t_08_01 t_08_02 t_08_03 t_08_04 t_08_05 t_08_06 t_08_07 t_08_08
    ];
