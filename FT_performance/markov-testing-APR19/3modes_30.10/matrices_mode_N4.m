%% n = 4

%% transition matrix n=4 -> 11 states
m_01_01 = 0;
m_01_02 = Pfm(1);
m_01_03 = 0;
m_01_04 = 0;
m_01_05 = 1-Pfm(1);
m_01_06 = 0;
m_01_07 = 0;
m_01_08 = 0;
m_01_09 = 0;
m_01_10 = 0;
m_01_11 = 0;

m_02_01 = 0;
m_02_02 = 0;
m_02_03 = Pfm(2);
m_02_04 = 0;
m_02_05 = 0;
m_02_06 = 1-Pfm(2);
m_02_07 = 0;
m_02_08 = 0;
m_02_09 = 0;
m_02_10 = 0;
m_02_11 = 0;

m_03_01 = 0;
m_03_02 = 0;
m_03_03 = 0;
m_03_04 = Pfm(3);
m_03_05 = 0;
m_03_06 = 0;
m_03_07 = 1-Pfm(3);
m_03_08 = 0;
m_03_09 = 0;
m_03_10 = 0;
m_03_11 = 0; 

m_04_01 = 0;
m_04_02 = 0;
m_04_03 = 0;
m_04_04 = 0;
m_04_05 = 0;
m_04_06 = 0;
m_04_07 = 0;
m_04_08 = 1-Pfm(4);
m_04_09 = 0;
m_04_10 = 0;
m_04_11 = Pfm(4);

m_05_01 = 0;
m_05_02 = 0;
m_05_03 = 0;
m_05_04 = 0;
m_05_05 = 1-(x1+y1);
if f(1)-1 == 0
  m_05_06 = 1-Pfm(1);
  m_05_11 = Pfm(1);
else
  m_05_06 = x1;
  m_05_11 = y1;
end
m_05_07 = 0;
m_05_08 = 0;
m_05_09 = 0;
m_05_10 = 0;

m_06_01 = 0;
m_06_02 = 0;
m_06_03 = 0;
m_06_04 = 0;
m_06_05 = 0;
m_06_06 = 1-(x2+y2);
m_06_07 = 0;
m_06_08 = 0;
if f(2)-1 == 0
  m_06_09 = 1-Pfm(2);
  m_06_11 = Pfm(2);
else
  m_06_09 = x2;
  m_06_11 = y2;
end
m_06_10 = 0;


m_07_01 = 0;
m_07_02 = 0;
m_07_03 = 0;
m_07_04 = 0;
m_07_05 = 0;
m_07_06 = 0;
m_07_07 = 1-(x3+y3);
m_07_08 = 0;
m_07_09 = 0;
if f(3)-1 == 0
    m_07_10 = 1-Pfm(3);
    m_07_11 = Pfm(3);
else
    m_07_10 = x3;
    m_07_11 = y3;
end


m_08_01 = 0;
m_08_02 = 0;
m_08_03 = 0;
m_08_04 = 0;
m_08_05 = 0;
m_08_06 = 0;
if f(4)-1 == 0
    m_08_07 = 1-Pfm(4);
    m_08_11 = Pfm(4);
else
    m_08_07 = x4;
    m_08_11 = y4;    
end
m_08_08 = 1-(x4+y4);
m_08_09 = 0;
m_08_10 = 0;


m_09_01 = 0;
m_09_02 = 0;
m_09_03 = 0;
m_09_04 = 0;
m_09_05 = 1-Pfm(2);
m_09_06 = 0;
m_09_07 = Pfm(2);
m_09_08 = 0;
m_09_09 = 0;
m_09_10 = 0;
m_09_11 = 0;


m_10_01 = 0;
m_10_02 = 0;
m_10_03 = 0;
m_10_04 = 0;
m_10_05 = 0;
m_10_06 = 1-Pfm(3);
m_10_07 = 0;
m_10_08 = Pfm(3);
m_10_09 = 0;
m_10_10 = 0;
m_10_11 = 0;


m_11_01 = 0;
m_11_02 = 0;
m_11_03 = 0;
m_11_04 = 0;
m_11_05 = 0;
m_11_06 = 0;
m_11_07 = 0;
m_11_08 = 0;
m_11_09 = 0;
m_11_10 = 0;
m_11_11 = 1;







M_N4 = [
    m_01_01 m_01_02 m_01_03 m_01_04 m_01_05 m_01_06 m_01_07 m_01_08 m_01_09 m_01_10 m_01_11; ...
    m_02_01 m_02_02 m_02_03 m_02_04 m_02_05 m_02_06 m_02_07 m_02_08 m_02_09 m_02_10 m_02_11; ...
    m_03_01 m_03_02 m_03_03 m_03_04 m_03_05 m_03_06 m_03_07 m_03_08 m_03_09 m_03_10 m_03_11; ...
    m_04_01 m_04_02 m_04_03 m_04_04 m_04_05 m_04_06 m_04_07 m_04_08 m_04_09 m_04_10 m_04_11; ...
    m_05_01 m_05_02 m_05_03 m_05_04 m_05_05 m_05_06 m_05_07 m_05_08 m_05_09 m_05_10 m_05_11; ...
    m_06_01 m_06_02 m_06_03 m_06_04 m_06_05 m_06_06 m_06_07 m_06_08 m_06_09 m_06_10 m_06_11; ...
    m_07_01 m_07_02 m_07_03 m_07_04 m_07_05 m_07_06 m_07_07 m_07_08 m_07_09 m_07_10 m_07_11; ...
    m_08_01 m_08_02 m_08_03 m_08_04 m_08_05 m_08_06 m_08_07 m_08_08 m_08_09 m_08_10 m_08_11; ...
    m_09_01 m_09_02 m_09_03 m_09_04 m_09_05 m_09_06 m_09_07 m_09_08 m_09_09 m_09_10 m_09_11; ...
    m_10_01 m_10_02 m_10_03 m_10_04 m_10_05 m_10_06 m_10_07 m_10_08 m_10_09 m_10_10 m_10_11; ...
    m_11_01 m_11_02 m_11_03 m_11_04 m_11_05 m_11_06 m_11_07 m_11_08 m_11_09 m_11_10 m_11_11;
    ];


% time
t_01_01 = 0;
t_01_02 = tm(1);
t_01_03 = 0;
t_01_04 = 0;
t_01_05 = tm(1);
t_01_06 = 0;
t_01_07 = 0;
t_01_08 = 0;
t_01_09 = 0;
t_01_10 = 0;
t_01_11 = 0;

t_02_01 = 0;
t_02_02 = 0;
t_02_03 = tm(2);
t_02_04 = 0;
t_02_05 = 0;
t_02_06 = tm(2);
t_02_07 = 0;
t_02_08 = 0;
t_02_09 = 0;
t_02_10 = 0;
t_02_11 = 0;

t_03_01 = 0;
t_03_02 = 0;
t_03_03 = 0;
t_03_04 = tm(3);
t_03_05 = 0;
t_03_06 = 0;
t_03_07 = tm(3);
t_03_08 = 0;
t_03_09 = 0;
t_03_10 = 0;
t_03_11 = 0; 

t_04_01 = 0;
t_04_02 = 0;
t_04_03 = 0;
t_04_04 = 0;
t_04_05 = 0;
t_04_06 = 0;
t_04_07 = 0;
t_04_08 = tm(4);
t_04_09 = 0;
t_04_10 = 0;
t_04_11 = tm(4);

t_05_01 = 0;
t_05_02 = 0;
t_05_03 = 0;
t_05_04 = 0;
if f(1)-1 == 0
  t_05_05 = tm(1);
  t_05_06 = tm(1);
  t_05_11 = tm(1);
else
  t_05_05 = tm(1) * (f(1)-1);
  t_05_06 = tm(1) * (f(1)-1);
  t_05_11 = tm(1) * (f(1)-1);
end
t_05_07 = 0;
t_05_08 = 0;
t_05_09 = 0;
t_05_10 = 0;

t_06_01 = 0;
t_06_02 = 0;
t_06_03 = 0;
t_06_04 = 0;
t_06_05 = 0;
t_06_07 = 0;
t_06_08 = 0;
if f(2)-1 == 0
  t_06_06 = tm(2);
  t_06_09 = tm(2);
  t_06_11 = tm(2);
else
  t_06_06 = tm(2) * (f(2)-1);
  t_06_09 = tm(2) * (f(2)-1);
  t_06_11 = tm(2) * (f(2)-1);
end
t_06_10 = 0;


t_07_01 = 0;
t_07_02 = 0;
t_07_03 = 0;
t_07_04 = 0;
t_07_05 = 0;
t_07_06 = 0;
t_07_08 = 0;
t_07_09 = 0;
if f(3)-1 == 0
    t_07_07 = tm(3);
    t_07_10 = tm(3);
    t_07_11 = tm(3);
else
    t_07_07 = tm(3) * (f(3)-1);
    t_07_10 = tm(3) * (f(3)-1);
    t_07_11 = tm(3) * (f(3)-1);
end


t_08_01 = 0;
t_08_02 = 0;
t_08_03 = 0;
t_08_04 = 0;
t_08_05 = 0;
t_08_06 = 0;
if f(4)-1 == 0
    t_08_07 = tm(4);
    t_08_08 = tm(4);
    t_08_11 = tm(4);
else
    t_08_07 = tm(4) * (f(4)-1);
    t_08_08 = tm(4) * (f(4)-1);
    t_08_11 = tm(4) * (f(4)-1);
end
t_08_09 = 0;
t_08_10 = 0;


t_09_01 = 0;
t_09_02 = 0;
t_09_03 = 0;
t_09_04 = 0;
t_09_05 = tm(2);
t_09_06 = 0;
t_09_07 = tm(2);
t_09_08 = 0;
t_09_09 = 0;
t_09_10 = 0;
t_09_11 = 0;


t_10_01 = 0;
t_10_02 = 0;
t_10_03 = 0;
t_10_04 = 0;
t_10_05 = 0;
t_10_06 = tm(3);
t_10_07 = 0;
t_10_08 = tm(3);
t_10_09 = 0;
t_10_10 = 0;
t_10_11 = 0;


t_11_01 = 0;
t_11_02 = 0;
t_11_03 = 0;
t_11_04 = 0;
t_11_05 = 0;
t_11_06 = 0;
t_11_07 = 0;
t_11_08 = 0;
t_11_09 = 0;
t_11_10 = 0;
t_11_11 = 0;


T_N4 = [
    t_01_01 t_01_02 t_01_03 t_01_04 t_01_05 t_01_06 t_01_07 t_01_08 t_01_09 t_01_10 t_01_11; ...
    t_02_01 t_02_02 t_02_03 t_02_04 t_02_05 t_02_06 t_02_07 t_02_08 t_02_09 t_02_10 t_02_11; ...
    t_03_01 t_03_02 t_03_03 t_03_04 t_03_05 t_03_06 t_03_07 t_03_08 t_03_09 t_03_10 t_03_11; ...
    t_04_01 t_04_02 t_04_03 t_04_04 t_04_05 t_04_06 t_04_07 t_04_08 t_04_09 t_04_10 t_04_11; ...
    t_05_01 t_05_02 t_05_03 t_05_04 t_05_05 t_05_06 t_05_07 t_05_08 t_05_09 t_05_10 t_05_11; ...
    t_06_01 t_06_02 t_06_03 t_06_04 t_06_05 t_06_06 t_06_07 t_06_08 t_06_09 t_06_10 t_06_11; ...
    t_07_01 t_07_02 t_07_03 t_07_04 t_07_05 t_07_06 t_07_07 t_07_08 t_07_09 t_07_10 t_07_11; ...
    t_08_01 t_08_02 t_08_03 t_08_04 t_08_05 t_08_06 t_08_07 t_08_08 t_08_09 t_08_10 t_08_11; ...
    t_09_01 t_09_02 t_09_03 t_09_04 t_09_05 t_09_06 t_09_07 t_09_08 t_09_09 t_09_10 t_09_11; ...
    t_10_01 t_10_02 t_10_03 t_10_04 t_10_05 t_10_06 t_10_07 t_10_08 t_10_09 t_10_10 t_10_11; ...
    t_11_01 t_11_02 t_11_03 t_11_04 t_11_05 t_11_06 t_11_07 t_11_08 t_11_09 t_11_10 t_11_11;
    ];
